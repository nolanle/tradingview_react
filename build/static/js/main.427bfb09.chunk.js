(this["webpackJsonpreact-tv"]=this["webpackJsonpreact-tv"]||[]).push([[0],{103:function(e,t,n){"use strict";n.r(t);var i=n(6),r=n(0),o=n.n(r),s=n(7),c=n.n(s),a=(n(74),n(11)),u=n.n(a),l=n(16),h=n(24),f=n(25),d=n(43),b=n(41),v=n(56),p=n.n(v).a.create({timeout:1e5});p.interceptors.request.use(function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="".concat(t.baseURL||"").concat(t.url),console.log(" >> [REQUEST] ".concat(n,": ").concat(JSON.stringify(t.data))),e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),function(){var e=Object(l.a)(u.a.mark((function e(t){var n,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.code,i=t.message,console.log(" >> [REQUEST] error [".concat(n,"]: ").concat(i)),e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),p.interceptors.response.use(function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.config,console.log(" >> [RESPONSE] ".concat(n.url,":"),t.data?t.data:t),e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(" >> [RESPONSE]:",null===t||void 0===t?void 0:t.config.url,null===t||void 0===t?void 0:t.message),e.abrupt("return",t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var m="https://api.huobi.pro",y={common_symbols:"/v1/common/symbols",history_kline:"/market/history/kline"};function k(e,t,n){return g.apply(this,arguments)}function g(){return(g=Object(l.a)(u.a.mark((function e(t,n,i){var r,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(r=y[t])?"".concat(m).concat(r):t,r=n?r+n:r,e.next=5,p.get(r,i).catch((function(){}));case 5:return o=e.sent,e.abrupt("return",o?o.data:void 0);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=n(57),j=n(58),O=n.n(j),S=n(59),x=new(function(){function e(){Object(h.a)(this,e),this.url="wss://api.huobi.pro/ws",this.ws=null,this.success={},this.failure={},this.timer=null,this.evt=new S.EventEmitter}return Object(f.a)(e,[{key:"initWebSocket",value:function(){this.ws=new WebSocket(this.url),this.ws.binaryType="arraybuffer",this.ws.onopen=this.onopen.bind(this),this.ws.onclose=this.onclose.bind(this),this.ws.onerror=this.onerror.bind(this),this.ws.onmessage=this.onmessage.bind(this),console.log(" >> WebSocket init :",this.url)}},{key:"onopen",value:function(){if(this.ws){if(console.log(" >> WebSocket open..."),this.timer)for(var e in clearInterval(this.timer),this.timer=null,this.success)this.ws.send(this.success[e]),console.log(" >> WebSocket send: ".concat(this.success[e]));for(var t in this.failure)this.success[t]||(this.ws.send(this.failure[t]),this.success[t]=this.failure[t],console.log(" >> WebSocket send: ".concat(this.failure[t])));this.failure={}}}},{key:"onclose",value:function(){this.ws=null,console.log(" >> Websocket Close..."),this.timer||this.onReconnection()}},{key:"onerror",value:function(e){console.log(" >> Websocket Error...",e)}},{key:"onmessage",value:function(e){if(e.data){var t,n=w.a.inflate(e.data,{to:"string"}),i=JSON.parse(n);if(i&&i.ping)null===(t=this.ws)||void 0===t||t.send(JSON.stringify({pong:Date.now()}));else this.onBroadcast(i)}}},{key:"onBroadcast",value:function(e){this.success[e.ch]&&this.evt.emit(e.ch,e)}},{key:"subscribe",value:function(e,t,n){var i,r=this;return i=this.ws&&this.ws.readyState===WebSocket.OPEN?this.successPush(e,t,n):this.failurePush(e,t,n),{remove:function(){r.unsubscribe(e),i.removeAllListeners(e)}}}},{key:"unsubscribe",value:function(e){if(this.failure[e]&&delete this.failure[e],this.success[e])if(this.ws){var t=JSON.parse(this.success[e]);t.cmd="unsub",this.ws.send(JSON.stringify(t)),this.evt.removeAllListeners(e),console.log(" >> WebSocket send: ".concat(JSON.stringify(t))),delete this.success[e]}else delete this.success[e]}},{key:"successPush",value:function(e,t,n){var i;return this.success[e]=JSON.stringify(t),null===(i=this.ws)||void 0===i||i.send(this.success[e]),console.log(" >> WebSocket send: ".concat(this.success[e])),this.evt.on(e,n)}},{key:"failurePush",value:function(e,t,n){return this.failure[e]=JSON.stringify(t),console.log(" >> WebSocket \u51c6\u5907\u8ba2\u9605: ".concat(this.failure[e])),this.evt.on(e,n)}},{key:"onReconnection",value:function(){var e=this;this.url&&(this.initWebSocket(),this.timer=setInterval((function(){e.initWebSocket();var t=O()().format("YYYY-MM-DD HH:mm:ss");console.log(" >> [".concat(t,"] WebSocket Reconnect...."))}),3e3))}}]),e}()),C=n(137),_=n(139),L=n(140),R=n(44),W=n(135),N=n(61),D=n.n(N),E=Object(W.a)((function(e){return{root:{flexGrow:1},menu:{marginRight:e.spacing(2)}}}));function P(e){var t=E();return Object(i.jsx)("div",{className:t.root,children:Object(i.jsx)(C.a,{position:"static",children:Object(i.jsxs)(_.a,{variant:"dense",children:[Object(i.jsx)(L.a,{edge:"start",color:"inherit","aria-label":"menu",className:t.menu,onClick:e.onClick,children:Object(i.jsx)(D.a,{})}),Object(i.jsx)(R.a,{variant:"h6",color:"inherit",children:e.title})]})})})}var U=n(62),M=n(46),B={1:{server:"1min",name:"1m"},5:{server:"5min",name:"5m"},30:{server:"30min",name:"30m"},60:{server:"60min",name:"1h"},240:{server:"4hour",name:"4h"},1440:{server:"1day",name:"1D"},10080:{server:"1week",name:"1W"},302400:{server:"1mon",name:"1M"}},J=function(e){Object(d.a)(n,e);var t=Object(b.a)(n);function n(e){var i;return Object(h.a)(this,n),(i=t.call(this,e)).interval="5",i.widget=void 0,i.datafeed=void 0,i.buttons=[],i.height=void 0,i.isMobile=function(){return new RegExp("(iPhone|iPad|iPod|iOS|Android)","i").test(navigator.userAgent)},i.fetchResolveSymbol=function(e){return new Promise((function(t){var n=i.props.symbol,r="".concat(n["base-currency"].toLocaleUpperCase(),"/").concat(n["quote-currency"].toLocaleUpperCase());t({name:r,full_name:r,description:e,type:"stock",session:"24x7",exchange:"",listed_exchange:"",timezone:"Asia/Shanghai",format:"price",pricescale:Math.pow(10,n["price-precision"]),minmov:1,volume_precision:n["value-precision"],has_intraday:!0,supported_resolutions:Object.keys(B),has_weekly_and_monthly:!0,has_daily:!0})}))},i.fetchConfiguration=function(){return new Promise((function(e){e({supported_resolutions:Object.keys(B)})}))},i.fetchKLineData=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r,o,s,c,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],o=window.innerWidth,t.firstDataRequest){e.next=4;break}return e.abrupt("return",{bars:r,meta:{noData:!0}});case 4:return t.resolution!==i.interval&&(i.unsubscribeKLine(),i.interval=t.resolution),e.next=7,k("history_kline",void 0,{params:{symbol:null===(n=i.props.symbol)||void 0===n?void 0:n.symbol,period:B[i.interval].server,size:o>2e3?2e3:o}});case 7:if((s=e.sent)&&s.data&&s.data.length){e.next=10;break}return e.abrupt("return",{bars:r,meta:{noData:!0}});case 10:for(c=0;c<s.data.length;c++)a=s.data[c],r.push({time:1e3*a.id,open:a.open,high:a.high,low:a.low,close:a.close,volume:a.vol});return r.sort((function(e,t){return e.time>t.time?1:-1})),t.firstDataRequest&&i.subscribeKLine(),e.abrupt("return",{bars:r,meta:{noData:!0}});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i.subscribeKLine=function(){var e,t=null===(e=i.props.symbol)||void 0===e?void 0:e.symbol,n=B[i.interval].server,r="market.".concat(t,".kline.").concat(n);x.subscribe(r,{id:"tv",sub:r},(function(e){var t=e.tick;i.datafeed.updateKLine({time:1e3*t.id,open:t.open,high:t.high,low:t.low,close:t.close,volume:t.vol})}))},i.unsubscribeKLine=function(){var e,t=null===(e=i.props.symbol)||void 0===e?void 0:e.symbol,n=B[i.interval].server;x.unsubscribe("market.".concat(t,".kline.").concat(n))},i.initTradingView=function(){var e=i.props.symbol,t="".concat(e["base-currency"].toLocaleUpperCase(),"/").concat(e["quote-currency"].toLocaleUpperCase());i.widget=new M.widget({locale:"zh",theme:"Light",fullscreen:!1,symbol:t,interval:i.interval,container_id:"tv_chart_container",datafeed:i.datafeed,library_path:"./charting_library/",timezone:"Asia/Shanghai",enabled_features:["hide_last_na_study_output"],disabled_features:["volume_force_overlay","header_resolutions","header_compare","header_undo_redo"],preset:i.isMobile()?"mobile":void 0}),i.widget.headerReady().then((function(){if(i.buttons=[],!i.isMobile()){var e=function(e){var t=B[e],n=i.widget.createButton();n.setAttribute("interval",e),n.textContent=t.name,n.addEventListener("click",(function(){return i.onButtonClick(e)})),i.buttons.push(n)};for(var t in B)e(t);i.addButtonColor()}})).catch((function(){}))},i.onButtonClick=function(e){e!==i.interval&&i.widget.chart().setResolution(e,(function(){i.isMobile()?i.forceUpdate():i.addButtonColor()}))},i.addButtonColor=function(){var e,t=Object(U.a)(i.buttons);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.getAttribute("interval")===i.interval?n.style.color="#1878F3":n.style.color="#131722"}}catch(r){t.e(r)}finally{t.f()}},i.onChangeSymbol=function(e){var t;i.unsubscribeKLine(),null===(t=i.widget)||void 0===t||t.setSymbol("".concat(e["base-currency"].toLocaleUpperCase(),"/").concat(e["quote-currency"].toLocaleUpperCase()),i.interval,(function(){}))},i.state={},i.datafeed=new M.DataFeed({getBars:i.fetchKLineData,fetchResolveSymbol:i.fetchResolveSymbol,fetchConfiguration:i.fetchConfiguration}),i.height=window.innerHeight-(i.isMobile()?88:48),i}return Object(f.a)(n,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){this.widget&&this.widget.remove()}},{key:"render",value:function(){var e=this;return Object(i.jsxs)("div",{className:"kline-wrapp",children:[this.isMobile()?Object(i.jsx)("div",{className:"kline-list",children:Object.keys(B).map((function(t){return Object(i.jsx)("div",{className:"kline-item",onClick:function(){return e.onButtonClick(t)},style:{color:t===e.interval?"#1878F3":"#131722"},children:B[t].name},t)}))}):null,Object(i.jsx)("div",{id:"tv_chart_container",style:{height:window.innerHeight-48}})]})}}]),n}(r.Component),q=n(145),A=n(141),K=n(142),F=n(144),T=n(143),z=n(146),H=function(e){Object(d.a)(n,e);var t=Object(b.a)(n);function n(e){var i;return Object(h.a)(this,n),(i=t.call(this,e)).klineRef=null,i.onOpen=function(){},i.onClose=function(){},i.onClick=function(){var e=i.state.visible;i.setState({visible:!e})},i.onSelected=function(e){i.state.code!==e.symbol&&(i.setState({code:e.symbol}),i.klineRef&&i.klineRef.onChangeSymbol(e)),i.onClick()},i.state={code:"btcusdt",visible:!1,list:[]},i}return Object(f.a)(n,[{key:"fetchSymbolList",value:function(){var e=Object(l.a)(u.a.mark((function e(){var t,n,i,r,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k("common_symbols");case 2:if((t=e.sent)&&t.data){e.next=5;break}return e.abrupt("return");case 5:for(n={},i=0;i<t.data.length;i++)"online"!==(r=t.data[i]).state||"usdt"!==r["quote-currency"]||/\d/.test(r["base-currency"])||(n[r["base-currency"]]=r);o=Object.keys(n).sort(),this.setState({list:o.map((function(e){return n[e]}))});case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=this;x.initWebSocket(),this.fetchSymbolList().then((function(){e.klineRef&&e.klineRef.initTradingView()}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.code,r=t.visible,o=t.list,s=o.find((function(e){return e.symbol===n})),c=s?"".concat(s["base-currency"].toLocaleUpperCase(),"/").concat(s["quote-currency"].toLocaleUpperCase()):"";return Object(i.jsxs)("div",{className:"kline",children:[Object(i.jsx)(P,{onClick:this.onClick,title:c}),Object(i.jsx)(J,{symbol:s,ref:function(t){return e.klineRef=t}}),Object(i.jsx)(q.a,{open:r,onOpen:this.onOpen,onClose:this.onClose,ModalProps:{onBackdropClick:this.onClick},children:Object(i.jsx)(A.a,{dense:!0,children:o.map((function(t,r){return Object(i.jsxs)(K.a,{button:!0,selected:n===t.symbol,children:[Object(i.jsx)(T.a,{children:Object(i.jsx)(z.a,{alt:"Avatar n\xb0".concat(r+1),src:"".concat("https://static.okex.com/cdn/oksupport/asset/currency/icon/").concat(t["base-currency"],".png?x-oss-process=image/format,webp")})}),Object(i.jsx)(F.a,{style:{color:n===t.symbol?"red":"inherit"},primary:"".concat(t["base-currency"].toLocaleUpperCase(),"/").concat(t["quote-currency"].toLocaleUpperCase()),onClick:function(){return e.onSelected(t)}})]},t.symbol)}))})})]})}}]),n}(r.Component),I=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,148)).then((function(t){var n=t.getCLS,i=t.getFID,r=t.getFCP,o=t.getLCP,s=t.getTTFB;n(e),i(e),r(e),o(e),s(e)}))};c.a.render(Object(i.jsx)(o.a.StrictMode,{children:Object(i.jsx)(H,{})}),document.getElementById("root")),I()},74:function(e,t,n){}},[[103,1,2]]]);
//# sourceMappingURL=main.427bfb09.chunk.js.map